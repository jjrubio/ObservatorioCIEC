{% extends "base.html" %}

{% load apptags %}

{% load static from staticfiles %}

{% block title %}Upload file csv{% endblock %}

{% block extraCSS %}
    <link href="{% static "css/uploadcsv.css" %}" rel="stylesheet"  />
{% endblock %}

{% block content %}
    <div class="content-page-2">
        {% if upload_success %}
            <b id="title-content-page">Subida de archivo Exitoso</b>
            <hr class="pull-left" id="separator-content-page">
            <div class="panel-body">
                <div class="center">
                    <div class="col-lg-4"></div>
                    <!-- <div class="col-lg-4">
                        <br/><br/><br/>
                        <span>Para subir otro archivo, por favor dar clic <a href="/subir_csv_comercio/">aquí</a></span>
                        <br/><br/><br/>
                    </div> -->
                    {% if actualizar %}
                        <div class="col-lg-4">
                            <br/><br/><br/>
                            <span>Si desea actualizar las tablas de exportación o importación de los diferentes estándares, por favor escoger una opción y dar clic en el botón "Actualizar".</span>
                            <br><br>
                            <span>Escoja una opción</span>
                            <select id="options_update" data-width="100%" class="selectpicker">
                                <option value="0">Exportación</option>
                                <option value="1">Importación</option>
                            </select>
                            <br><br>
                            <label>
                                <input type="button" class="btn btn-primary" value="Actualizar" id="btn_update">
                            </label>
                            <br><br>
                            <span>Caso contrario, si desea subir más archivos, por favor dar clic <a href="/subir_csv_comercio/">aquí</a></span>
                            <br/><br/><br/>
                        </div>
                    {% else %}
                        <div class="col-lg-4">
                            <br/><br/><br/>
                            <span>Para subir otro archivo, por favor dar clic <a href="/subir_csv_comercio/">aquí</a></span>
                            <br/><br/><br/>
                        </div>
                    {% endif %}
                </div>
            </div>
        {% else %}
            <b id="title-content-page">Subir archivo</b>
            <hr class="pull-left" id="separator-content-page">
            {% if empty %}
                <div class="panel-body">
                    <div class="center">
                        <div class="col-lg-4"></div>
                        <div class="col-lg-4">
                            <br/><br/><br/>
                            <span>Error! Usted no ha seleccionado un archivo, dar clic <a href="/subir_csv_comercio/">aquí</a> para regresar</span>
                            <br/><br/><br/>
                        </div>
                    </div>
                </div>
            {% else %}      
                <div class="panel-body" id="formulario">
                    <div class="center">
                        <form id="form_upload" method="post" action="subida_csv/" enctype="multipart/form-data">
                            {% csrf_token %}
                            <div class="col-lg-3">
                                <span class="texto">Escoja que tabla desea actualizar los datos: </span><br/>
                            </div>
                            <select class="form-control" id="id_choices" name="choices">
                                <option value="1">CGCE</option>
                                <option value="2">CIIU3</option>
                                <option value="3">CPC</option>
                                <option value="4">CUODE</option>
                                <option value="5">NANDINA</option>
                                <option value="6">PAISES</option>
                                <option value="7">EQUIVALENCIA</option>
                                <option value="8">DATOS EXPORTACIÓN</option>
                                <option value="9">DATOS IMPORTACIÓN</option>
                            </select>
                            <br/><br/>           
                            <div class="col-lg-3">
                                <span class="texto">Escoja un archivo txt o csv:</span><br/>
                            </div>
                            <label class="btn btn-default browse-wrap">
                                <input id="file" name="file" type="file" style="display:none;">
                                Seleccionar archivo
                            </label>
                            <span class="upload-path">&nbsp;&nbsp;&nbsp;No ha seleccionado un archivo </span>
                            <br/><br/>
                            <div class="col-lg-4"></div>
                            <div class="col-lg-4" id="btn-send">
                                <input type="submit" value="Cargar archivo" class="btn btn-primary"/><br/>
                            </div>
                            <div class="col-lg-4"></div>
                        </form>
                    </div>
                </div>
            {% endif %}
        {% endif %}
    </div>
{% endblock %}

{% block extraScripts %}

<script type="text/javascript">
    $('input[type="file"]').change(function(){
        $(this).closest('.browse-wrap').next('.upload-path').text(this.files[0].name);
    });
    $('#btn_update').click(function(){
        var id_options_update = $('#options_update option:selected').attr('value');
        console.log(id_options_update);

        $.getJSON('/actualizar-datos/', {'valor_k':id_options_update}, function(data){
            console.log(data);
        });
    });
</script>

{% endblock %}